<Project>

  <Target Name="CleanProject"
          BeforeTargets="Clean">
    <ItemGroup>
      <FoldersToClean Include="$(DistDir)" />
      <FoldersToClean Include="$(FeedOutputPath)"
                      Condition="'$(UseLocalFeed)' != 'true'" />
      <FoldersToClean Include="$(PackageOutputPath)"
                      Condition="'$(UseLocalFeed)' != 'true'" />
      <FoldersToClean Include="$(MSBuildProjectDirectory)\bin" />
      <FoldersToClean Include="$(MSBuildProjectDirectory)\obj" />
    </ItemGroup>
    <RemoveDir Directories="@(FoldersToClean)" />
  </Target>

  <Target Name="UpdateFeed"
          AfterTargets="Pack">
    <!-- Clean the local feed -->
    <PropertyGroup>
      <FeedPackagePath>$(FeedOutputPath)\$(MSBuildProjectName.ToLower())</FeedPackagePath>
    </PropertyGroup>
    <RemoveDir Directories="$(FeedPackagePath)"
               Condition="Exists($(FeedPackagePath))" />
    <!-- Add the built packages to the local feed -->
    <Exec Command="$(NuGetExePath) init $(PackageOutputPath) $(FeedOutputPath)" />
  </Target>

</Project>